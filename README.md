# MandelbortSetCalculate-Render
计算和渲染曼德勃罗集的两套程序。

包含了一个用来生成计算结果的c艹程序（Mandelbrot.exe），以及很多个计算、渲染和生成视频的matlab函数。

在代码中我习惯用一个矩阵Map代指一帧的计算结果。比如一张1080×1920的图片，它每个元素都对应一个像素，每个像素都对应一个复数。那么Map就是一个1080×1920的uint16/uint32矩阵，每个元素都是这个复数的逃逸时间（迭代至模大于2所需的迭代次数）。这个迭代次数也被我称之为Age。渲染就是对这样一个Map矩阵着色，得到1080×1920×3的Pic矩阵。
Scale是个包含2个复数的向量，第一个元素和第二个元素分布标明了一个画面中左上角和右下角像素所对应的复数。
每一个画面的横向是实轴（从左向右），纵向是虚轴（从上向下），复平面实际上被上下翻转了。幸好曼德勃罗集是沿实轴对称的，不受影响。


Mandelbrot.exe生成的计算结果是.Frame后缀名的二进制文件，包含了若干个画面的Map矩阵。
（要注意.Frame不是成品的图片或视频，它只是存储了Map矩阵，是有待渲染的计算结果。）
其格式如下：每一帧的开头都有一个9字节的标识符，前5个字节固定为'Frame'的字符串，后4个字节用字符表示这一帧是第几帧（均无\0终止符）。后面是以列优先方式存储的1080×1920的uint16的Map矩阵，每个元素占2个字节，共1920×1080×2个字节。
所以每一帧画面的计算结果都有1920×1080×2+9=4147209Byte，大约是3.955MB大小。这不是个很聪明的存储方式，也没做什么压缩，但用起来方便，可以分批执行计算任务。
使用列优先方式存储，是为了便于matlab读取.Frame文件并渲染（matlab是列优先）。

calMand.cpp以及Mandelbrot.h是Mandelbrot.exe的源代码，只要你修改了源代码中放大的中心点（Center）、迭代次数（Depth）、放大倍率（ratio）、视频的尺寸（Width和Height）、帧的数量（FrameStart和FrameEnd），编译出来的程序就可以计算出你想要的计算结果。

渲染和视频导出由matlab进行。在\MatlabFunction\MandRender 文件夹下有多个可以进行渲染的方法（不过都不是很成熟），视频中我使用的是MandLinerRender和MandDistRender。
我直接调用的是MandRenderVideo，它根据我提供的路径去读取.Frame文件，调用渲染函数来着色，并输出至名为v的VideoWriter中。VideoWriter需要自己配置，函数只负责输出，这样可以把多段.Frame文件渲染为一个完整的视频片段。
其他的函数有些用来渲染，有些用来计算，比如MandMap是最普通的计算M集的函数（类似于c艹程序，但它直接返回一个Map数组）。只使用matlab也可以制作视频，但计算过程使用了太多的循环，对matlab来说执行效率可能不太理想，所以最后我还是使用了c艹程序。（我也不会别的语言了）

还有一些其他乱七八糟的函数，懒得写介绍了。

代码水平一般般，勿喷
